---
# tasks file for nginx
 - name: Update apt cache
   ansible.builtin.apt:
   update_cache: yes
   cache_valid_time: 3600

 - name: Install nginx
   ansible.builtin.apt:
   name: "nginx"
   state: present
   notify: start nginx

 - name: Deploy custom index.html from template
   ansible.builtin.template:
   src: templates/index.html.j2
   dest: "/var/www/html/index.html"
   mode: "0644"
   notify: restart nginx

 - name: Ensure nginx is running
   ansible.builtin.command: pgrep nginx
   register: nginx_check
   changed_when: false
   failed_when: false
 
 - name: Start nginx if not running
   ansible.builtin.command: nginx
   when: nginx_check.rc != 0

 - name: Verify nginx is running
   ansible.builtin.command: pgrep nginx
   register: nginx_verify
   changed_when: false
   failed_when: nginx_verify.rc != 0

 - name: Display nginx status
   ansible.builtin.debug:
   msg: "Nginx is running on {{ inventory_hostname }} at {{ ansible_host }}"